version: 2

models:
## Final
  - name: quality_measures__summary_counts
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: summary_counts
      tags: quality_measures
      materialized: table
    description: Reporting measure counts with performance rates.
    columns:
      - name: measure_id
        description: Unique measure identification number.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/quality_measures/quality_measures__measures.csv
      - name: measure_name
        description: Name of the measure.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/quality_measures/quality_measures__measures.csv
      - name: measure_version
        description: Version of the measure.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/quality_measures/quality_measures__measures.csv
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: denominator_sum
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_sum
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved with exclusion logic applied.
      - name: exclusion_sum
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: performance_rate
        description: >
          Calculated performance rate. The numerator sum divided by the 
          denominator sum after exclusion logic applied and multiplied by 100.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__summary_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: summary_long
      tags: quality_measures
      materialized: table
    description: >
      Long view of the results for the reporting version of all measures.
      Each row represents the results a measure per patient. A null for the 
      denominator indicates that the patient was not eligible for that measure.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: performance_flag
        description: >
          Performance flag calculated by using exclusion, numerator, and 
          denominator flags. When excluded from a measure the flag is null.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/quality_measures/quality_measures__measures.csv
      - name: measure_name
        description: Name of the measure.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/quality_measures/quality_measures__measures.csv
      - name: measure_version
        description: Version of the measure.
        meta:
          terminology: https://github.com/tuva-health/the_tuva_project/blob/main/seeds/value_sets/quality_measures/quality_measures__measures.csv
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__summary_wide
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: summary_wide
      tags: quality_measures
      materialized: table
    description: >
      Wide view of the results for the reporting version of all measures.
      This model pivots measures on the patient level (i.e. one row per patient
      with flags for each measure. The false flags can be treated as care gaps
      as exclusions have been included in the pivot logic.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: nqf_2372
        description: >
          Performance flag for NQF2372, Breast Cancer Screening. A null 
          indicates that the measure was not applicable for the patient.
      - name: nqf_0034
        description: >
          Performance flag for NQF0034, Colorectal Cancer Screening. A null 
          indicates that the measure was not applicable for the patient.
      - name: nqf_0059
        description: >
          Performance flag for NQF0059, Diabetes: Hemoglobin A1c (HbA1c) Poor 
          Control (> 9%). A null indicates that the measure was not applicable 
          for the patient.
      - name: cqm_236
        description: >
          Performance flag for CQM236, Controlling High Blood Pressure. A null 
          indicates that the measure was not applicable for the patient.
      - name: nqf_0053
        description: >
          Performance flag for NQF0053, Osteoporosis Management in Women Who 
          Had a Fracture. A null indicates that the measure was not applicable 
          for the patient.
      - name: cbe_0055
        description: >
          Performance flag for CBE0055, Diabetes: Eye Exam. A null 
          indicates that the measure was not applicable for the patient.
      - name: cqm_438
        description: >
          Performance flag for CQM438, Statin Therapy for the Prevention and 
          Treatment of Cardiovascular Disease. A null indicates that the 
          measure was not applicable for the patient.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

## Shared Exclusions
  - name: quality_measures__int_shared_exclusions_frailty
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_shared_exclusions_frailty
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients with frailty used by other exclusion models.

  - name: quality_measures__int_shared_exclusions_advanced_illness
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_shared_exclusions_advanced_illness
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients with frailty and advanced illness for entire patient population.

  - name: quality_measures__int_shared_exclusions_dementia
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_shared_exclusions_dementia
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients with frailty and taking dementia medications for entire patient population.

  - name: quality_measures__int_shared_exclusions_hospice_palliative
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_shared_exclusions_hospice_palliative
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients using hospice or palliative services for the reporting for entire patient population.

  - name: quality_measures__int_shared_exclusions_institutional_snp
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_shared_exclusions_institutional_snp
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients staying in an institution for the reporting for entire patient population. 

## Intermediate
### Breast Cancer Screening
  - name: quality_measures__int_nqf2372__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf2372__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Breast Cancer screening.

  - name: quality_measures__int_nqf2372_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf2372_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of NQF 2372, Breast Cancer 
      Screening.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: age
        description: Patient's age as of the performance_period_begin date.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: performance_period_lookback
        description: Lookback period of NQF2372.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf2372_exclude_mastectomy
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf2372_exclude_mastectomy
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients with a mastectomy for the reporting 
      version of NQF 2372, Breast Cancer Screening.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf2372_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf2372_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of NQF 2372, Breast Cancer 
      Screening.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf2372_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf2372_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of NQF 2372, Breast Cancer 
      Screening before combining with other measures.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf2372_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf2372_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of NQF 2372, Breast Cancer 
      Screening.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

### Colorectal Cancer Screening
  - name: quality_measures__int_nqf0034_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0034_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of NQF 0034, Colorectal Cancer 
      Screening.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: min_age
        description: Patient's minumum age during encounter as of the performance_period.
      - name: max_age
        description: Patient's maximum age during encounter as of the performance_period.
      - name: qualifying_types
        description: Indicative letter of patient's type of encounter.
      
  - name: quality_measures__int_nqf0034_exclude_colectomy_cancer
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0034_exclude_colectomy_cancer
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients with frailty and advanced illness for 
      the reporting version of NQF 0034, Colorectal Cancer Screening.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: exclusion_date
        description: Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_type
        description: Measure specific exclusion for historical record of colectomy cancer.
      - name: tuva_last_run 
        desciption: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf0034_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0034_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of NQF 0034, Colorectal Cancer Screening.      
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf0034_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0034_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of NQF 0034, Colorectal Cancer Screening
      before combining with other measures.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.
      
  - name: quality_measures__int_nqf0034_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0034_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of NQF 0034,
      Colorectal Cancer Screening
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence
        description: Reason (usually the value set concept name) that includes patient 
          from the measure.

  - name: quality_measures__int_nqf0034__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0034__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for NQF 0034 Colorectal Cancer screening.
    
### Diabetes Hemoglobin a1c
  - name: quality_measures__int_nqf0059__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0059__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Diabetes Hemoglobin a1c.

  - name: quality_measures__int_nqf0059_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0059_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of NQF 0059, Diabetes Hemoglobin a1c.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: age
        description: Patient's age as of the performance_period_begin date.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf0059_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0059_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of NQF 0059, Diabetes Hemoglobin a1c.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf0059_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0059_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of NQF 0059,Diabetes Hemoglobin a1c before combining with other measures.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf0059_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0059_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of NQF 0059, Diabetes Hemoglobin a1c.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

### Controlling Blood Pressure
  - name: quality_measures__int_cqm236__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm236__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Controlling Blood Pressure.

  - name: quality_measures__int_cqm236_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm236_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of CQM 236, Controlling Blood Pressure
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: age
        description: Patient's age as of the performance_period_begin date.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm236_exclude_procedures_observations
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm236_exclude_procedures_observations
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients with certain observations and procedures for 
      the reporting version of CQM 236, Controlling Blood Pressure.

  - name: quality_measures__int_cqm236_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm236_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of CQM 236, Controlling Blood Pressure.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm236_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm236_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of CQM 236, Controlling Blood Pressure.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm236_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm236_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of CQM 236,Controlling Blood Pressure before combining with other measures.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

### Osteoporosis Management in women who had a fracture
  - name: quality_measures__int_nqf0053__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0053__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Osteoporosis Management in women who had a fracture

  - name: quality_measures__int_nqf0053_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0053_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of NQF 0053, Osteoporosis Management in women who had a fracture
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: recorded_date
        description: Date of incident/fracture recorded.
      - name: age
        description: Patient's age as of the performance_period_begin date.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf0053_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0053_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of NQF 0053, Osteoporosis Management in women who had a fracture
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf0053_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0053_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of NQF 0053, Osteoporosis Management in women who had a fracture.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.
        
  - name: quality_measures__int_nqf0053_exclude_procedures_medications
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0053_exclude_procedures_medications
      tags: quality_measures
      materialized: table
    description: >
      Exclusion logic for patients with certain procedures and medicatons for 
      the reporting version of NQF 0053, Osteoporosis Management in women who had a fracture.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: exclusion_date
        description: Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_type
        description: measure specific exclusion for procedure medication.
      - name: tuva_last_run 
        desciption: The date and timestamp of the dbt run.

  - name: quality_measures__int_nqf0053_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_nqf0053_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of NQF 0053, Osteoporosis Management in women who had a fracture before combining with other measures.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

### Diabetes: Eye Exam
  - name: quality_measures__int_cbe0055__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cbe0055__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Diabetes: Eye Exam

  - name: quality_measures__int_cbe0055__denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cbe0055_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for the reporting version of Diabetes: Eye Exam
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: age
        description: Patient's age as of the performance_period_begin date.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cbe0055_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cbe0055_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of CBE 0055, Diabetes: Eye Exam
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cbe0055_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cbe0055_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of CBE 0055, Diabetes: Eye Exam.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cbe0055_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cbe0055_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of CBE 0055, Diabetes: Eye Exam before combining with other measures.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

### Statin Therapy for the Prevention and Treatment of Cardiovascular Disease
  - name: quality_measures__int_cqm438__performance_period
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438__performance_period
      tags: quality_measures
      materialized: view
    description: >
      Performance Period definition for Statin Therapy for the Prevention and Treatment of Cardiovascular Disease

  - name: quality_measures__int_cqm438_denominator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438_denominator
      tags: quality_measures
      materialized: table
    description: >
      Denominator logic for submission of the reporting version of Statin Therapy for the Prevention and Treatment of Cardiovascular Disease
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: age
        description: Patient's age as of performance_period_begin date.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm438_numerator
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438_numerator
      tags: quality_measures
      materialized: table
    description: >
      Numerator logic for the reporting version of CQM 438, Statin Therapy for the Prevention and Treatment of Cardiovascular Disease
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm438_exclusions
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438_exclusions
      tags: quality_measures
      materialized: table
    description: >
      Combined exclusion logic for the reporting version of CQM 438, Statin Therapy for the Prevention and Treatment of Cardiovascular Disease.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

  - name: quality_measures__int_cqm438_long
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _int_cqm438_long
      tags: quality_measures
      materialized: table
    description: >
      Final preparation of the reporting version of CQM 438, Statin Therapy for the Prevention and Treatment of Cardiovascular Disease before combining with other measures.
    columns:
      - name: patient_id
        description: Unique patient_id for each person.
      - name: denominator_flag
        description: >
          The denominator is associated with a given patient population that 
          may be counted as eligible to meet a measure’s inclusion requirements.
      - name: numerator_flag
        description: >
          The numerator reflects the subset of patients in the denominator 
          for whom a particular service has been provided or for whom a 
          particular outcome has been achieved.
      - name: exclusion_flag
        description: >
          Specifications of those characteristics that would cause groups of 
          individuals to be removed from the numerator and/or denominator of 
          a measure although they experience the denominator index event.
      - name: evidence_date
        description: >
          Date of event or service that places patient in the numerator.
      - name: evidence_value
        description: >
          Observed evidence value for the patients in the numerator.
      - name: exclusion_date
        description: >
          Date of event or service that excludes patient from the measure.
      - name: exclusion_reason
        description: >
          Reason (usually the value set concept name) that excludes patient 
          from the measure.
      - name: performance_period_begin
        description: Beginning date of the performance or measurement period.
      - name: performance_period_end
        description: Ending date of the performance or measurement period.
      - name: measure_id
        description: Unique measure identification number.
      - name: measure_name
        description: Name of the measure.
      - name: measure_version
        description: Version of the measure.
      - name: tuva_last_run
        description: The date and timestamp of the dbt run.

## Staging
  - name: quality_measures__stg_core__condition
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_condition
      tags: quality_measures
      materialized: ephemeral
    description: Staging conditions from core.
    columns:
      - name: patient_id
        tests:
          - not_null:
              severity: warn
      - name: recorded_date
      - name: source_code_type
      - name: source_code
      - name: normalized_code_type
      - name: normalized_code
      - name: tuva_last_run

  - name: quality_measures__stg_core__encounter
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_encounter
      tags: quality_measures
      materialized: ephemeral
    description: >
      Staging encounters from core. Creates an empty table if using claims only.
    columns:
      - name: patient_id
        tests:
          - not_null:
              severity: warn
      - name: encounter_type
      - name: encounter_start_date
      - name: encounter_end_date
      - name: tuva_last_run

  - name: quality_measures__stg_core__medication
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_medication
      tags: quality_measures
      materialized: ephemeral
    description: >
      Staging medications from core. Creates an empty table if using claims only.
    columns:
      - name: patient_id
        tests:
          - not_null:
              severity: warn
      - name: encounter_id
      - name: prescribing_date
      - name: dispensing_date
      - name: ndc_code
      - name: rxnorm_code
      - name: tuva_last_run

  - name: quality_measures__stg_core__observation
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_observation
      tags: quality_measures
      materialized: ephemeral
    description: >
      Staging medications from core. Creates an empty table if using claims only.
    columns:
      - name: patient_id
        tests:
          - not_null:
              severity: warn
      - name: observation_date
      - name: source_code_type
      - name: source_code
      - name: normalized_code_type
      - name: normalized_code
      - name: tuva_last_run

  - name: quality_measures__stg_core__patient
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_patient
      tags: quality_measures
      materialized: ephemeral
    description: Staging eligibility from the input layer.
    columns:
      - name: patient_id
        tests:
          - not_null:
              severity: warn
      - name: sex
        tests:
          - not_null:
              severity: warn
          - accepted_values:
              values: ['female', 'male','unknown']
              severity: warn
      - name: birth_date
        tests:
          - not_null:
              severity: warn
      - name: death_date
      - name: tuva_last_run

  - name: quality_measures__stg_core__procedure
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_procedure
      tags: quality_measures
      materialized: ephemeral
    description: Staging procedures from core.
    columns:
      - name: patient_id
        tests:
          - not_null:
              severity: warn
      - name: procedure_date
      - name: source_code_type
      - name: source_code
      - name: normalized_code_type
      - name: normalized_code
      - name: tuva_last_run

  - name: quality_measures__stg_medical_claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_medical_claim
      tags: quality_measures
      materialized: ephemeral
    description: >
      Staging medical claims from the input layer. Creates an empty table if 
      using clinical only.
    columns:
      - name: patient_id
      - name: claim_start_date
      - name: claim_end_date
      - name: place_of_service
      - name: hcpcs_code
      - name: tuva_last_run

  - name: quality_measures__stg_pharmacy_claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_pharmacy_claim
      tags: quality_measures
      materialized: ephemeral
    description: >
      Staging pharmacy claims from the input layer. Creates an empty table if 
      using clinical only.
    columns:
      - name: patient_id
      - name: dispensing_date
      - name: ndc_code
      - name: paid_date
      - name: tuva_last_run


  - name: quality_measures__stg_core__lab_result
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_quality_measures{% else %}quality_measures{%- endif -%}
      alias: _stg_lab_result
      tags: quality_measures
      materialized: ephemeral
    description: >
      Staging lab results from the input layer. Creates an empty table if 
      using claims only.
    columns:
      - name: patient_id
      - name: result_date
      - name: collection_date
      - name: source_code_type
      - name: source_code
      - name: normalized_code_type
      - name: normalized_code
